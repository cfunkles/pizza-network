<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script
        src="http://code.jquery.com/jquery-3.2.1.js"
        integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./index.css">
    <title>*Complete Pizzeria List*</title>
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a href="#" class="navbar-brand">
                    <!--placeholder image for future logo-->
                    <img src="http://www.hey.fr/fun/emoji/android/en/icon/android/227-emoji_android_slice_of_pizza.png" alt="firebrick-logo">
                </a>
                <!--Create better title style the shit out of this!-->
                <h4 id='site-name'>Pizza-Network</h4>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <!--To Do: change to buttons, customize the sytle more-->
                <li><a href="home.html">Home</a></li>
                <li class="active"><a href="complete.html">Complete Pizzeria List</a> </li>
                <li><a href="chats.html">The Slicial Network</a></li>
            </ul>
        </div>
    </nav>
    <!--Sidebar for filtering pizza lists-->
    <div class="row container-fluid">
        <aside class="col-sm-3">
            <div class="btn-group-vertical btn-group-lg">
                <h2><span class="label label-primary">Find your Pizza spot!</span></h2>
                <button class="btn btn-info" id="popular">Voted Best</button>
                <button class="btn btn-info" id="new-york">New York Slice</button>
                <button class="btn btn-info" id="chicago">Chicago Deep Dish</button>
                <button class="btn btn-info" id="brick-oven">Brick Oven</button>
                <button class="btn btn-info" id="authentic">Authentic Style</button>
                <button class="btn btn-info" id="kid-friendly">Kid Friendly</button>
                <button class="btn btn-info" id="delivery">Delivers</button>
            </div>
        </aside>
        <!--The lists page, template ideas for what jquery builds-->
        
            <div class="col-md-8">
                <h2 id="list_title">All pizza places</h2>
                <!--change this title for which filter is being used-->
                <div class="row well">
                    <span class="col-md-5"><h4>Rosalee's Pizza</h4></span>
                    <span class="col-md-3"><p>Longmont, CO</p></span>
                    <span class="col-md-2"><p>Rating <img src="https://thumb1.shutterstock.com/thumb_large/494302/147935048/stock-vector-fast-food-vector-icon-slice-of-pepperoni-pizza-147935048.jpg" alt=""></p></span>
                    <span class="col-md-2"><button class="btn btn-info">Details</button></span>
                    <div class="details row">
                    <!--toggle this to show details-->
                        <span class="col-md-2"><p>Address: 461 Main, Longmont, Colorado 80501</p></span>
                        <span class="col-md-3"><p>Phone: 303-485-5020</p></span>
                        <span class="col-md-3"><a href="http://rosaleespizzeria.com/"><p>Website: http://rosaleespizzeria.com/</p></a></span>
                        <span class="col-md-2"><p>Shop Info: New York, No delievery, good for kids!</p></span>
                    </div>
                </div>
                <div class="row well">
                    <span class="col-md-5"><h4>Toppers Pizza</h4></span>
                    <span class="col-md-3"><p>Longmont, CO</p></span>
                    <span class="col-md-2"><p>Rating <img src="https://thumb1.shutterstock.com/thumb_large/494302/147935048/stock-vector-fast-food-vector-icon-slice-of-pepperoni-pizza-147935048.jpg" alt=""></p></span>
                    <span class="col-md-2"><button class="btn btn-info">Details</button></span>
                </div>
                <div class="row well">
                    <span class="col-md-5"><h4>Old Chicago Pizza</h4></span>
                    <span class="col-md-3"><p>Longmont, CO</p></span>
                    <span class="col-md-2"><p>Rating <img src="https://thumb1.shutterstock.com/thumb_large/494302/147935048/stock-vector-fast-food-vector-icon-slice-of-pepperoni-pizza-147935048.jpg" alt=""></p></span>
                    <span class="col-md-2"><button class="btn btn-info">Details</button></span>
                </div>
                <div class="row well">
                    <span class="col-md-5"><h4>Papa Murphys Pizza</h4></span>
                    <span class="col-md-3"><p>Longmont, CO</p></span>
                    <span class="col-md-2"><p>Rating <img src="https://thumb1.shutterstock.com/thumb_large/494302/147935048/stock-vector-fast-food-vector-icon-slice-of-pepperoni-pizza-147935048.jpg" alt=""></p></span>
                    <span class="col-md-2"><button class="btn btn-info">Details</button></span>
                </div>
               
                <div class="container">
                    <div class="pizzerias">
                        <div id="output"></div>
                    </div>
                </div>


                <div id="pizzeriaTemplate" style="display: none">
                    <div class="col-md-8">
                        <div class="pizzeria">
                            <!-- pizzeria name get hypertext to their profile -->
                            <h2 class="pizzaName"></h2>
                            <p class="pizzaTel"></p>
                            <p class="pizzaAdd"></p>
                            <p class="pizzaCity"></p>
                            <p class="pizzaState"></p>
                            <!-- alter output format to clickable link -->
                            <p class="pizzaURL"></p>
                            <!-- alter output to soimething boolean friendly -->
                            <p class="pizzaNY"></p>
                            <p class="pizzaDD"></p>
                            <p class="pizzaBO"></p>
                            <p class="pizzaAU"></p>
                            <p class="pizzaDel"></p>
                            <p class="pizzaKids"></p>
                            <!-- pizza slice buttons -->
                            <p class="upVotes"></p>
                            <button class="btn btn-info upper">Up Slice</button>
                            <p class="downVotes"></p>
		            		<button class="btn btn-info downer">Down Slice</button>
                        </div>
                    </div>
                </div>
            </div>
       
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            getPizzerias();
        })

        function upListener(pizzeria) {
            return function() {
                $.post('/api/upvote', {_id: pizzeria._id}, function(data) {
                    console.log(data);
                    getPizzerias();
                })
            }
        }

        function downListener(pizzeria) {
            return function() {
                $.post('/api/downvote', {_id: pizzeria._id}, function(data) {
                    console.log(data);
                    getPizzerias();
                })
            }
        }

        function getPizzerias () {
            $.ajax({
                method: 'GET',
                url: '/api/getPizzerias', 
                success: function(response) {
                    $('#output').empty();
                    for (var i = 0; i < response.length; i++) {
                        var pizzaDiv = $('#pizzeriaTemplate').children().first().clone();
                        pizzaDiv.find('.pizzaName').text(response[i].name);
                        //format for phone numbers
                        pizzaDiv.find('.pizzaTel').text(response[i].phone);
                        pizzaDiv.find('.pizzaAdd').text(response[i].address);
                        pizzaDiv.find('.pizzaCity').text(response[i].city);
                        pizzaDiv.find('.pizzaState').text(response[i].state);
                        pizzaDiv.find('.pizzaURL').text(response[i].url);
                        //consider different output format for these booleans
                        pizzaDiv.find('.pizzaNY').text(response[i].newYork);
                        pizzaDiv.find('.pizzaDD').text(response[i].deepDish);
                        pizzaDiv.find('.pizzaBO').text(response[i].brickOven);
                        pizzaDiv.find('.pizzaAU').text(response[i].authentic);
                        pizzaDiv.find('.pizzaDel').text(response[i].delivery);
                        pizzaDiv.find('.pizzaKids').text(response[i].kids);
                        //add click listener closure functions to vote on this page
                        pizzaDiv.find('.upVotes').text(response[i].upVotes);
                        pizzaDiv.find('.upper').click(upListener(response[i].upVotes));
                        pizzaDiv.find('.downVotes').text(response[i].downVotes);
                        pizzaDiv.find('.downer').click(downListener(response[i].downVotes));
                        $('#output').append(pizzaDiv);
                    }
                },
                error: function(err) {
                    $('#pizzeria').text('500 internal server error!');
                }
            });
        }

        // function popularSort(data) {
        //     var popular = {};
        //     for (var i = 0; i < data.length; i++) {
        //         data[i].upVotes - data[i].downVotes;
        //     }
        //     popular.sort(function(a, b) {
        //         return a - b;
        //     })
        //     return popular;
        // }

        //attach voting sort to click listener here

        function newYorkSort(data) {
            var newYork = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].newYork === "yes") {
                    newYork.push(data[i]);
                }
            }
            return newYork;
        }

        $('#new-york').click(function() {
            $.get('/api/getPizzerias', function(data) {
                console.log(newYorkSort(data));
                //put into template and populate
            })
        })

        function deepDishSort(data) {
            var deepDish = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].deepDish === "yes") {
                    deepDish.push(data[i]);
                }
            }
            return deepDish;
        }

        $('#chicago').click(function() {
            $.get('/api/getPizzerias', function(data) {
                console.log(deepDishSort(data));
                //put into template and populate
            })
        })

        function brickOvenSort(data) {
            var brickOven = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].brickOven === "yes") {
                    brickOven.push(data[i]);
                }
            }
            return brickOven;
        }

        $('#brick-oven').click(function() {
            $.get('/api/getPizzerias', function(data) {
                console.log(brickOvenSort(data));
                //put into template and populate
            })
        })

        function authenticSort(data) {
            var authentic = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].authentic === "yes") {
                    authentic.push(data[i]);
                }
            }
            return authentic;
        }

        $('#authentic').click(function() {
            $.post('/api/getPizzerias', function(data) {
                console.log(authenticSort(data));
                //put into template and populate
            })
        })

        function deliverySort(data) {
            var delivery = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].delivery === "yes") {
                    delivery.push(data[i]);
                }
            }
            return delivery;
        }

        $('#delivery').click(function() {
            $.post('/api/getPizzerias', function(data) {
                console.log(deliverySort(data));
                //put into template and populate
            })
        })

        function kidSort(data) {
            var kid = [];
            for (var i = 0; i < data.length; i++) {
                if (data[i].kid === "yes") {
                    kid.push(data[i]);
                }
            }
            return kid;
        }

        $('#kid-friendly').click(function() {
            $.post('/api/getPizzerias', function(data) {
                console.log(kidSort(data));
                //put into template and populate
            })
        })
        // //write this to toggle details and select the specific button being clicked
        // $('.details').click(function() {
        //     $('.details').slideDown();
        // });
    </script>
    
</body>
</html>